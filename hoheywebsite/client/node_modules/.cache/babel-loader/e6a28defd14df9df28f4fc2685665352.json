{"ast":null,"code":"'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.clearTimeout = exports.dispose = exports.postMessage = exports.init = exports.messagePromises = exports.error = exports.timeout = exports.initPromise = exports.origin = exports.instance = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _deferred = require(\"../utils/deferred\");\n\nvar _ui = require(\"../constants/ui\");\n\nvar _errors = require(\"../constants/errors\");\n\nvar _inlineStyles = _interopRequireDefault(require(\"./inline-styles\"));\n\nvar instance;\nexports.instance = instance;\nvar origin;\nexports.origin = origin;\nvar initPromise = (0, _deferred.create)();\nexports.initPromise = initPromise;\nvar timeout = 0;\nexports.timeout = timeout;\nvar error;\nexports.error = error;\nvar _messageID = 0; // every postMessage to iframe has its own promise to resolve\n\nvar messagePromises = {};\nexports.messagePromises = messagePromises;\n\nvar init = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(settings) {\n    var existedFrame, manifestString, manifest, src, iframeSrcHost, onLoad;\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            existedFrame = document.getElementById('trezorconnect');\n\n            if (existedFrame) {\n              exports.instance = instance = existedFrame;\n            } else {\n              exports.instance = instance = document.createElement('iframe');\n              instance.frameBorder = '0';\n              instance.width = '0px';\n              instance.height = '0px';\n              instance.style.position = 'absolute';\n              instance.style.display = 'none';\n              instance.style.border = '0px';\n              instance.style.width = '0px';\n              instance.style.height = '0px';\n              instance.id = 'trezorconnect';\n            }\n\n            manifestString = settings.manifest ? JSON.stringify(settings.manifest) : 'undefined'; // note: btoa(undefined) === btoa('undefined') === \"dW5kZWZpbmVk\"\n\n            manifest = \"&version=\" + settings.version + \"&manifest=\" + encodeURIComponent(btoa(JSON.stringify(manifestString)));\n            src = settings.iframeSrc + \"?\" + Date.now() + manifest;\n            instance.setAttribute('src', src);\n\n            if (settings.webusb) {\n              instance.setAttribute('allow', 'usb');\n            } // eslint-disable-next-line no-irregular-whitespace, no-useless-escape\n\n\n            iframeSrcHost = instance.src.match(/^.+\\:\\/\\/[^\\/]+/);\n\n            if (iframeSrcHost && iframeSrcHost.length > 0) {\n              exports.origin = origin = iframeSrcHost[0];\n            }\n\n            exports.timeout = timeout = window.setTimeout(function () {\n              initPromise.reject(_errors.IFRAME_TIMEOUT);\n            }, 10000);\n\n            onLoad = function onLoad() {\n              if (!instance) {\n                initPromise.reject(_errors.IFRAME_BLOCKED);\n                return;\n              }\n\n              try {\n                // if hosting page is able to access cross-origin location it means that the iframe is not loaded\n                var iframeOrigin = instance.contentWindow.location.origin;\n\n                if (!iframeOrigin || iframeOrigin === 'null') {\n                  // eslint-disable-next-line no-use-before-define\n                  handleIframeBlocked();\n                  return;\n                }\n              } catch (e) {// empty\n              }\n\n              var extension; // $FlowIssue chrome is not declared outside\n\n              if (typeof chrome !== 'undefined' && chrome.runtime && typeof chrome.runtime.onConnect !== 'undefined') {\n                chrome.runtime.onConnect.addListener(function () {});\n                extension = chrome.runtime.id;\n              }\n\n              instance.contentWindow.postMessage({\n                type: _ui.IFRAME_HANDSHAKE,\n                payload: {\n                  settings: settings,\n                  extension: extension\n                }\n              }, origin);\n              instance.onload = undefined;\n            }; // IE hack\n\n\n            if (instance.attachEvent) {\n              instance.attachEvent('onload', onLoad);\n            } else {\n              instance.onload = onLoad;\n            } // inject iframe into host document body\n\n\n            if (document.body) {\n              document.body.appendChild(instance); // eslint-disable-next-line no-use-before-define\n\n              injectStyleSheet();\n            }\n\n            _context.prev = 13;\n            _context.next = 16;\n            return initPromise.promise;\n\n          case 16:\n            _context.next = 21;\n            break;\n\n          case 18:\n            _context.prev = 18;\n            _context.t0 = _context[\"catch\"](13);\n            throw _context.t0.message || _context.t0;\n\n          case 21:\n            _context.prev = 21;\n            window.clearTimeout(timeout);\n            exports.timeout = timeout = 0;\n            return _context.finish(21);\n\n          case 25:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[13, 18, 21, 25]]);\n  }));\n\n  return function init(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.init = init;\n\nvar injectStyleSheet = function injectStyleSheet() {\n  if (!instance) {\n    throw _errors.IFRAME_BLOCKED;\n  }\n\n  var doc = instance.ownerDocument;\n  var head = doc.head || doc.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.setAttribute('type', 'text/css');\n  style.setAttribute('id', 'TrezorConnectStylesheet'); // $FlowIssue\n\n  if (style.styleSheet) {\n    // IE\n    // $FlowIssue\n    style.styleSheet.cssText = _inlineStyles[\"default\"];\n  } else {\n    style.appendChild(document.createTextNode(_inlineStyles[\"default\"]));\n  }\n\n  head.append(style);\n};\n\nvar handleIframeBlocked = function handleIframeBlocked() {\n  window.clearTimeout(timeout);\n  exports.error = error = _errors.IFRAME_BLOCKED.message; // eslint-disable-next-line no-use-before-define\n\n  dispose();\n  initPromise.reject(_errors.IFRAME_BLOCKED);\n}; // post messages to iframe\n\n\nvar postMessage = function postMessage(message, usePromise) {\n  if (usePromise === void 0) {\n    usePromise = true;\n  }\n\n  if (!instance) {\n    throw _errors.IFRAME_BLOCKED;\n  }\n\n  if (usePromise) {\n    _messageID++;\n    message.id = _messageID;\n    messagePromises[_messageID] = (0, _deferred.create)();\n    instance.contentWindow.postMessage(message, origin);\n    return messagePromises[_messageID].promise;\n  }\n\n  instance.contentWindow.postMessage(message, origin);\n  return null;\n};\n\nexports.postMessage = postMessage;\n\nvar dispose = function dispose() {\n  if (instance && instance.parentNode) {\n    try {\n      instance.parentNode.removeChild(instance);\n    } catch (error) {// do nothing\n    }\n  }\n\n  exports.instance = instance = null;\n  exports.timeout = timeout = 0;\n};\n\nexports.dispose = dispose;\n\nvar clearTimeout = function clearTimeout() {\n  window.clearTimeout(timeout);\n};\n\nexports.clearTimeout = clearTimeout;","map":{"version":3,"sources":["/Users/kelvinho/Documents/Coding/HoHey-main 4 2/hoheywebsite/client/src/example/node_modules/trezor-connect/lib/iframe/builder.js"],"names":["_interopRequireDefault","require","exports","__esModule","clearTimeout","dispose","postMessage","init","messagePromises","error","timeout","initPromise","origin","instance","_regenerator","_asyncToGenerator2","_deferred","_ui","_errors","_inlineStyles","create","_messageID","_ref","mark","_callee","settings","existedFrame","manifestString","manifest","src","iframeSrcHost","onLoad","wrap","_callee$","_context","prev","next","document","getElementById","createElement","frameBorder","width","height","style","position","display","border","id","JSON","stringify","version","encodeURIComponent","btoa","iframeSrc","Date","now","setAttribute","webusb","match","length","window","setTimeout","reject","IFRAME_TIMEOUT","IFRAME_BLOCKED","iframeOrigin","contentWindow","location","handleIframeBlocked","e","extension","chrome","runtime","onConnect","addListener","type","IFRAME_HANDSHAKE","payload","onload","undefined","attachEvent","body","appendChild","injectStyleSheet","promise","t0","message","finish","stop","_x","apply","arguments","doc","ownerDocument","head","getElementsByTagName","styleSheet","cssText","createTextNode","append","usePromise","parentNode","removeChild"],"mappings":"AAAA;;AAEA,IAAIA,sBAAsB,GAAGC,OAAO,CAAC,8CAAD,CAApC;;AAEAC,OAAO,CAACC,UAAR,GAAqB,IAArB;AACAD,OAAO,CAACE,YAAR,GAAuBF,OAAO,CAACG,OAAR,GAAkBH,OAAO,CAACI,WAAR,GAAsBJ,OAAO,CAACK,IAAR,GAAeL,OAAO,CAACM,eAAR,GAA0BN,OAAO,CAACO,KAAR,GAAgBP,OAAO,CAACQ,OAAR,GAAkBR,OAAO,CAACS,WAAR,GAAsBT,OAAO,CAACU,MAAR,GAAiBV,OAAO,CAACW,QAAR,GAAmB,KAAK,CAAzM;;AAEA,IAAIC,YAAY,GAAGd,sBAAsB,CAACC,OAAO,CAAC,4BAAD,CAAR,CAAzC;;AAEA,IAAIc,kBAAkB,GAAGf,sBAAsB,CAACC,OAAO,CAAC,yCAAD,CAAR,CAA/C;;AAEA,IAAIe,SAAS,GAAGf,OAAO,CAAC,mBAAD,CAAvB;;AAEA,IAAIgB,GAAG,GAAGhB,OAAO,CAAC,iBAAD,CAAjB;;AAEA,IAAIiB,OAAO,GAAGjB,OAAO,CAAC,qBAAD,CAArB;;AAEA,IAAIkB,aAAa,GAAGnB,sBAAsB,CAACC,OAAO,CAAC,iBAAD,CAAR,CAA1C;;AAEA,IAAIY,QAAJ;AACAX,OAAO,CAACW,QAAR,GAAmBA,QAAnB;AACA,IAAID,MAAJ;AACAV,OAAO,CAACU,MAAR,GAAiBA,MAAjB;AACA,IAAID,WAAW,GAAG,CAAC,GAAGK,SAAS,CAACI,MAAd,GAAlB;AACAlB,OAAO,CAACS,WAAR,GAAsBA,WAAtB;AACA,IAAID,OAAO,GAAG,CAAd;AACAR,OAAO,CAACQ,OAAR,GAAkBA,OAAlB;AACA,IAAID,KAAJ;AACAP,OAAO,CAACO,KAAR,GAAgBA,KAAhB;AACA,IAAIY,UAAU,GAAG,CAAjB,C,CAAoB;;AAEpB,IAAIb,eAAe,GAAG,EAAtB;AACAN,OAAO,CAACM,eAAR,GAA0BA,eAA1B;;AAEA,IAAID,IAAI,GACR,aACA,YAAY;AACV,MAAIe,IAAI,GAAG,CAAC,GAAGP,kBAAkB,CAAC,SAAD,CAAtB,GACX,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwBS,IAAxB,CAA6B,SAASC,OAAT,CAAiBC,QAAjB,EAA2B;AACtD,QAAIC,YAAJ,EAAkBC,cAAlB,EAAkCC,QAAlC,EAA4CC,GAA5C,EAAiDC,aAAjD,EAAgEC,MAAhE;AACA,WAAOjB,YAAY,CAAC,SAAD,CAAZ,CAAwBkB,IAAxB,CAA6B,SAASC,QAAT,CAAkBC,QAAlB,EAA4B;AAC9D,aAAO,CAAP,EAAU;AACR,gBAAQA,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAACE,IAAjC;AACE,eAAK,CAAL;AACEV,YAAAA,YAAY,GAAGW,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CAAf;;AAEA,gBAAIZ,YAAJ,EAAkB;AAChBxB,cAAAA,OAAO,CAACW,QAAR,GAAmBA,QAAQ,GAAGa,YAA9B;AACD,aAFD,MAEO;AACLxB,cAAAA,OAAO,CAACW,QAAR,GAAmBA,QAAQ,GAAGwB,QAAQ,CAACE,aAAT,CAAuB,QAAvB,CAA9B;AACA1B,cAAAA,QAAQ,CAAC2B,WAAT,GAAuB,GAAvB;AACA3B,cAAAA,QAAQ,CAAC4B,KAAT,GAAiB,KAAjB;AACA5B,cAAAA,QAAQ,CAAC6B,MAAT,GAAkB,KAAlB;AACA7B,cAAAA,QAAQ,CAAC8B,KAAT,CAAeC,QAAf,GAA0B,UAA1B;AACA/B,cAAAA,QAAQ,CAAC8B,KAAT,CAAeE,OAAf,GAAyB,MAAzB;AACAhC,cAAAA,QAAQ,CAAC8B,KAAT,CAAeG,MAAf,GAAwB,KAAxB;AACAjC,cAAAA,QAAQ,CAAC8B,KAAT,CAAeF,KAAf,GAAuB,KAAvB;AACA5B,cAAAA,QAAQ,CAAC8B,KAAT,CAAeD,MAAf,GAAwB,KAAxB;AACA7B,cAAAA,QAAQ,CAACkC,EAAT,GAAc,eAAd;AACD;;AAEDpB,YAAAA,cAAc,GAAGF,QAAQ,CAACG,QAAT,GAAoBoB,IAAI,CAACC,SAAL,CAAexB,QAAQ,CAACG,QAAxB,CAApB,GAAwD,WAAzE,CAlBF,CAkBwF;;AAEtFA,YAAAA,QAAQ,GAAG,cAAcH,QAAQ,CAACyB,OAAvB,GAAiC,YAAjC,GAAgDC,kBAAkB,CAACC,IAAI,CAACJ,IAAI,CAACC,SAAL,CAAetB,cAAf,CAAD,CAAL,CAA7E;AACAE,YAAAA,GAAG,GAAGJ,QAAQ,CAAC4B,SAAT,GAAqB,GAArB,GAA2BC,IAAI,CAACC,GAAL,EAA3B,GAAwC3B,QAA9C;AACAf,YAAAA,QAAQ,CAAC2C,YAAT,CAAsB,KAAtB,EAA6B3B,GAA7B;;AAEA,gBAAIJ,QAAQ,CAACgC,MAAb,EAAqB;AACnB5C,cAAAA,QAAQ,CAAC2C,YAAT,CAAsB,OAAtB,EAA+B,KAA/B;AACD,aA1BH,CA0BI;;;AAGF1B,YAAAA,aAAa,GAAGjB,QAAQ,CAACgB,GAAT,CAAa6B,KAAb,CAAmB,iBAAnB,CAAhB;;AAEA,gBAAI5B,aAAa,IAAIA,aAAa,CAAC6B,MAAd,GAAuB,CAA5C,EAA+C;AAC7CzD,cAAAA,OAAO,CAACU,MAAR,GAAiBA,MAAM,GAAGkB,aAAa,CAAC,CAAD,CAAvC;AACD;;AAED5B,YAAAA,OAAO,CAACQ,OAAR,GAAkBA,OAAO,GAAGkD,MAAM,CAACC,UAAP,CAAkB,YAAY;AACxDlD,cAAAA,WAAW,CAACmD,MAAZ,CAAmB5C,OAAO,CAAC6C,cAA3B;AACD,aAF2B,EAEzB,KAFyB,CAA5B;;AAIAhC,YAAAA,MAAM,GAAG,SAASA,MAAT,GAAkB;AACzB,kBAAI,CAAClB,QAAL,EAAe;AACbF,gBAAAA,WAAW,CAACmD,MAAZ,CAAmB5C,OAAO,CAAC8C,cAA3B;AACA;AACD;;AAED,kBAAI;AACF;AACA,oBAAIC,YAAY,GAAGpD,QAAQ,CAACqD,aAAT,CAAuBC,QAAvB,CAAgCvD,MAAnD;;AAEA,oBAAI,CAACqD,YAAD,IAAiBA,YAAY,KAAK,MAAtC,EAA8C;AAC5C;AACAG,kBAAAA,mBAAmB;AACnB;AACD;AACF,eATD,CASE,OAAOC,CAAP,EAAU,CAAC;AACZ;;AAED,kBAAIC,SAAJ,CAlByB,CAkBV;;AAEf,kBAAI,OAAOC,MAAP,KAAkB,WAAlB,IAAiCA,MAAM,CAACC,OAAxC,IAAmD,OAAOD,MAAM,CAACC,OAAP,CAAeC,SAAtB,KAAoC,WAA3F,EAAwG;AACtGF,gBAAAA,MAAM,CAACC,OAAP,CAAeC,SAAf,CAAyBC,WAAzB,CAAqC,YAAY,CAAE,CAAnD;AACAJ,gBAAAA,SAAS,GAAGC,MAAM,CAACC,OAAP,CAAezB,EAA3B;AACD;;AAEDlC,cAAAA,QAAQ,CAACqD,aAAT,CAAuB5D,WAAvB,CAAmC;AACjCqE,gBAAAA,IAAI,EAAE1D,GAAG,CAAC2D,gBADuB;AAEjCC,gBAAAA,OAAO,EAAE;AACPpD,kBAAAA,QAAQ,EAAEA,QADH;AAEP6C,kBAAAA,SAAS,EAAEA;AAFJ;AAFwB,eAAnC,EAMG1D,MANH;AAOAC,cAAAA,QAAQ,CAACiE,MAAT,GAAkBC,SAAlB;AACD,aAjCD,CAvCF,CAwEK;;;AAGH,gBAAIlE,QAAQ,CAACmE,WAAb,EAA0B;AACxBnE,cAAAA,QAAQ,CAACmE,WAAT,CAAqB,QAArB,EAA+BjD,MAA/B;AACD,aAFD,MAEO;AACLlB,cAAAA,QAAQ,CAACiE,MAAT,GAAkB/C,MAAlB;AACD,aA/EH,CA+EI;;;AAGF,gBAAIM,QAAQ,CAAC4C,IAAb,EAAmB;AACjB5C,cAAAA,QAAQ,CAAC4C,IAAT,CAAcC,WAAd,CAA0BrE,QAA1B,EADiB,CACoB;;AAErCsE,cAAAA,gBAAgB;AACjB;;AAEDjD,YAAAA,QAAQ,CAACC,IAAT,GAAgB,EAAhB;AACAD,YAAAA,QAAQ,CAACE,IAAT,GAAgB,EAAhB;AACA,mBAAOzB,WAAW,CAACyE,OAAnB;;AAEF,eAAK,EAAL;AACElD,YAAAA,QAAQ,CAACE,IAAT,GAAgB,EAAhB;AACA;;AAEF,eAAK,EAAL;AACEF,YAAAA,QAAQ,CAACC,IAAT,GAAgB,EAAhB;AACAD,YAAAA,QAAQ,CAACmD,EAAT,GAAcnD,QAAQ,CAAC,OAAD,CAAR,CAAkB,EAAlB,CAAd;AACA,kBAAMA,QAAQ,CAACmD,EAAT,CAAYC,OAAZ,IAAuBpD,QAAQ,CAACmD,EAAtC;;AAEF,eAAK,EAAL;AACEnD,YAAAA,QAAQ,CAACC,IAAT,GAAgB,EAAhB;AACAyB,YAAAA,MAAM,CAACxD,YAAP,CAAoBM,OAApB;AACAR,YAAAA,OAAO,CAACQ,OAAR,GAAkBA,OAAO,GAAG,CAA5B;AACA,mBAAOwB,QAAQ,CAACqD,MAAT,CAAgB,EAAhB,CAAP;;AAEF,eAAK,EAAL;AACA,eAAK,KAAL;AACE,mBAAOrD,QAAQ,CAACsD,IAAT,EAAP;AA9GJ;AAgHD;AACF,KAnHM,EAmHJhE,OAnHI,EAmHK,IAnHL,EAmHW,CAAC,CAAC,EAAD,EAAK,EAAL,EAAS,EAAT,EAAa,EAAb,CAAD,CAnHX,CAAP;AAoHD,GAtHD,CAFW,CAAX;;AA0HA,SAAO,SAASjB,IAAT,CAAckF,EAAd,EAAkB;AACvB,WAAOnE,IAAI,CAACoE,KAAL,CAAW,IAAX,EAAiBC,SAAjB,CAAP;AACD,GAFD;AAGD,CA9HD,EAFA;;AAkIAzF,OAAO,CAACK,IAAR,GAAeA,IAAf;;AAEA,IAAI4E,gBAAgB,GAAG,SAASA,gBAAT,GAA4B;AACjD,MAAI,CAACtE,QAAL,EAAe;AACb,UAAMK,OAAO,CAAC8C,cAAd;AACD;;AAED,MAAI4B,GAAG,GAAG/E,QAAQ,CAACgF,aAAnB;AACA,MAAIC,IAAI,GAAGF,GAAG,CAACE,IAAJ,IAAYF,GAAG,CAACG,oBAAJ,CAAyB,MAAzB,EAAiC,CAAjC,CAAvB;AACA,MAAIpD,KAAK,GAAGN,QAAQ,CAACE,aAAT,CAAuB,OAAvB,CAAZ;AACAI,EAAAA,KAAK,CAACa,YAAN,CAAmB,MAAnB,EAA2B,UAA3B;AACAb,EAAAA,KAAK,CAACa,YAAN,CAAmB,IAAnB,EAAyB,yBAAzB,EATiD,CASI;;AAErD,MAAIb,KAAK,CAACqD,UAAV,EAAsB;AACpB;AACA;AACArD,IAAAA,KAAK,CAACqD,UAAN,CAAiBC,OAAjB,GAA2B9E,aAAa,CAAC,SAAD,CAAxC;AACD,GAJD,MAIO;AACLwB,IAAAA,KAAK,CAACuC,WAAN,CAAkB7C,QAAQ,CAAC6D,cAAT,CAAwB/E,aAAa,CAAC,SAAD,CAArC,CAAlB;AACD;;AAED2E,EAAAA,IAAI,CAACK,MAAL,CAAYxD,KAAZ;AACD,CApBD;;AAsBA,IAAIyB,mBAAmB,GAAG,SAASA,mBAAT,GAA+B;AACvDR,EAAAA,MAAM,CAACxD,YAAP,CAAoBM,OAApB;AACAR,EAAAA,OAAO,CAACO,KAAR,GAAgBA,KAAK,GAAGS,OAAO,CAAC8C,cAAR,CAAuBsB,OAA/C,CAFuD,CAEC;;AAExDjF,EAAAA,OAAO;AACPM,EAAAA,WAAW,CAACmD,MAAZ,CAAmB5C,OAAO,CAAC8C,cAA3B;AACD,CAND,C,CAMG;;;AAGH,IAAI1D,WAAW,GAAG,SAASA,WAAT,CAAqBgF,OAArB,EAA8Bc,UAA9B,EAA0C;AAC1D,MAAIA,UAAU,KAAK,KAAK,CAAxB,EAA2B;AACzBA,IAAAA,UAAU,GAAG,IAAb;AACD;;AAED,MAAI,CAACvF,QAAL,EAAe;AACb,UAAMK,OAAO,CAAC8C,cAAd;AACD;;AAED,MAAIoC,UAAJ,EAAgB;AACd/E,IAAAA,UAAU;AACViE,IAAAA,OAAO,CAACvC,EAAR,GAAa1B,UAAb;AACAb,IAAAA,eAAe,CAACa,UAAD,CAAf,GAA8B,CAAC,GAAGL,SAAS,CAACI,MAAd,GAA9B;AACAP,IAAAA,QAAQ,CAACqD,aAAT,CAAuB5D,WAAvB,CAAmCgF,OAAnC,EAA4C1E,MAA5C;AACA,WAAOJ,eAAe,CAACa,UAAD,CAAf,CAA4B+D,OAAnC;AACD;;AAEDvE,EAAAA,QAAQ,CAACqD,aAAT,CAAuB5D,WAAvB,CAAmCgF,OAAnC,EAA4C1E,MAA5C;AACA,SAAO,IAAP;AACD,CAnBD;;AAqBAV,OAAO,CAACI,WAAR,GAAsBA,WAAtB;;AAEA,IAAID,OAAO,GAAG,SAASA,OAAT,GAAmB;AAC/B,MAAIQ,QAAQ,IAAIA,QAAQ,CAACwF,UAAzB,EAAqC;AACnC,QAAI;AACFxF,MAAAA,QAAQ,CAACwF,UAAT,CAAoBC,WAApB,CAAgCzF,QAAhC;AACD,KAFD,CAEE,OAAOJ,KAAP,EAAc,CAAC;AAChB;AACF;;AAEDP,EAAAA,OAAO,CAACW,QAAR,GAAmBA,QAAQ,GAAG,IAA9B;AACAX,EAAAA,OAAO,CAACQ,OAAR,GAAkBA,OAAO,GAAG,CAA5B;AACD,CAVD;;AAYAR,OAAO,CAACG,OAAR,GAAkBA,OAAlB;;AAEA,IAAID,YAAY,GAAG,SAASA,YAAT,GAAwB;AACzCwD,EAAAA,MAAM,CAACxD,YAAP,CAAoBM,OAApB;AACD,CAFD;;AAIAR,OAAO,CAACE,YAAR,GAAuBA,YAAvB","sourcesContent":["'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.clearTimeout = exports.dispose = exports.postMessage = exports.init = exports.messagePromises = exports.error = exports.timeout = exports.initPromise = exports.origin = exports.instance = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _deferred = require(\"../utils/deferred\");\n\nvar _ui = require(\"../constants/ui\");\n\nvar _errors = require(\"../constants/errors\");\n\nvar _inlineStyles = _interopRequireDefault(require(\"./inline-styles\"));\n\nvar instance;\nexports.instance = instance;\nvar origin;\nexports.origin = origin;\nvar initPromise = (0, _deferred.create)();\nexports.initPromise = initPromise;\nvar timeout = 0;\nexports.timeout = timeout;\nvar error;\nexports.error = error;\nvar _messageID = 0; // every postMessage to iframe has its own promise to resolve\n\nvar messagePromises = {};\nexports.messagePromises = messagePromises;\n\nvar init =\n/*#__PURE__*/\nfunction () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])(\n  /*#__PURE__*/\n  _regenerator[\"default\"].mark(function _callee(settings) {\n    var existedFrame, manifestString, manifest, src, iframeSrcHost, onLoad;\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            existedFrame = document.getElementById('trezorconnect');\n\n            if (existedFrame) {\n              exports.instance = instance = existedFrame;\n            } else {\n              exports.instance = instance = document.createElement('iframe');\n              instance.frameBorder = '0';\n              instance.width = '0px';\n              instance.height = '0px';\n              instance.style.position = 'absolute';\n              instance.style.display = 'none';\n              instance.style.border = '0px';\n              instance.style.width = '0px';\n              instance.style.height = '0px';\n              instance.id = 'trezorconnect';\n            }\n\n            manifestString = settings.manifest ? JSON.stringify(settings.manifest) : 'undefined'; // note: btoa(undefined) === btoa('undefined') === \"dW5kZWZpbmVk\"\n\n            manifest = \"&version=\" + settings.version + \"&manifest=\" + encodeURIComponent(btoa(JSON.stringify(manifestString)));\n            src = settings.iframeSrc + \"?\" + Date.now() + manifest;\n            instance.setAttribute('src', src);\n\n            if (settings.webusb) {\n              instance.setAttribute('allow', 'usb');\n            } // eslint-disable-next-line no-irregular-whitespace, no-useless-escape\n\n\n            iframeSrcHost = instance.src.match(/^.+\\:\\/\\/[^\\/]+/);\n\n            if (iframeSrcHost && iframeSrcHost.length > 0) {\n              exports.origin = origin = iframeSrcHost[0];\n            }\n\n            exports.timeout = timeout = window.setTimeout(function () {\n              initPromise.reject(_errors.IFRAME_TIMEOUT);\n            }, 10000);\n\n            onLoad = function onLoad() {\n              if (!instance) {\n                initPromise.reject(_errors.IFRAME_BLOCKED);\n                return;\n              }\n\n              try {\n                // if hosting page is able to access cross-origin location it means that the iframe is not loaded\n                var iframeOrigin = instance.contentWindow.location.origin;\n\n                if (!iframeOrigin || iframeOrigin === 'null') {\n                  // eslint-disable-next-line no-use-before-define\n                  handleIframeBlocked();\n                  return;\n                }\n              } catch (e) {// empty\n              }\n\n              var extension; // $FlowIssue chrome is not declared outside\n\n              if (typeof chrome !== 'undefined' && chrome.runtime && typeof chrome.runtime.onConnect !== 'undefined') {\n                chrome.runtime.onConnect.addListener(function () {});\n                extension = chrome.runtime.id;\n              }\n\n              instance.contentWindow.postMessage({\n                type: _ui.IFRAME_HANDSHAKE,\n                payload: {\n                  settings: settings,\n                  extension: extension\n                }\n              }, origin);\n              instance.onload = undefined;\n            }; // IE hack\n\n\n            if (instance.attachEvent) {\n              instance.attachEvent('onload', onLoad);\n            } else {\n              instance.onload = onLoad;\n            } // inject iframe into host document body\n\n\n            if (document.body) {\n              document.body.appendChild(instance); // eslint-disable-next-line no-use-before-define\n\n              injectStyleSheet();\n            }\n\n            _context.prev = 13;\n            _context.next = 16;\n            return initPromise.promise;\n\n          case 16:\n            _context.next = 21;\n            break;\n\n          case 18:\n            _context.prev = 18;\n            _context.t0 = _context[\"catch\"](13);\n            throw _context.t0.message || _context.t0;\n\n          case 21:\n            _context.prev = 21;\n            window.clearTimeout(timeout);\n            exports.timeout = timeout = 0;\n            return _context.finish(21);\n\n          case 25:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[13, 18, 21, 25]]);\n  }));\n\n  return function init(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.init = init;\n\nvar injectStyleSheet = function injectStyleSheet() {\n  if (!instance) {\n    throw _errors.IFRAME_BLOCKED;\n  }\n\n  var doc = instance.ownerDocument;\n  var head = doc.head || doc.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.setAttribute('type', 'text/css');\n  style.setAttribute('id', 'TrezorConnectStylesheet'); // $FlowIssue\n\n  if (style.styleSheet) {\n    // IE\n    // $FlowIssue\n    style.styleSheet.cssText = _inlineStyles[\"default\"];\n  } else {\n    style.appendChild(document.createTextNode(_inlineStyles[\"default\"]));\n  }\n\n  head.append(style);\n};\n\nvar handleIframeBlocked = function handleIframeBlocked() {\n  window.clearTimeout(timeout);\n  exports.error = error = _errors.IFRAME_BLOCKED.message; // eslint-disable-next-line no-use-before-define\n\n  dispose();\n  initPromise.reject(_errors.IFRAME_BLOCKED);\n}; // post messages to iframe\n\n\nvar postMessage = function postMessage(message, usePromise) {\n  if (usePromise === void 0) {\n    usePromise = true;\n  }\n\n  if (!instance) {\n    throw _errors.IFRAME_BLOCKED;\n  }\n\n  if (usePromise) {\n    _messageID++;\n    message.id = _messageID;\n    messagePromises[_messageID] = (0, _deferred.create)();\n    instance.contentWindow.postMessage(message, origin);\n    return messagePromises[_messageID].promise;\n  }\n\n  instance.contentWindow.postMessage(message, origin);\n  return null;\n};\n\nexports.postMessage = postMessage;\n\nvar dispose = function dispose() {\n  if (instance && instance.parentNode) {\n    try {\n      instance.parentNode.removeChild(instance);\n    } catch (error) {// do nothing\n    }\n  }\n\n  exports.instance = instance = null;\n  exports.timeout = timeout = 0;\n};\n\nexports.dispose = dispose;\n\nvar clearTimeout = function clearTimeout() {\n  window.clearTimeout(timeout);\n};\n\nexports.clearTimeout = clearTimeout;"]},"metadata":{},"sourceType":"module"}