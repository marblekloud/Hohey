{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst ethUtil = require(\"ethereumjs-util\");\n\nconst _ = require(\"lodash\");\n\nconst set_1 = require(\"../abstract_data_types/types/set\");\n\nconst constants_1 = require(\"../utils/constants\");\n\nconst tuple_1 = require(\"./tuple\");\n\nclass MethodDataType extends set_1.AbstractSetDataType {\n  constructor(abi, dataTypeFactory) {\n    const methodDataItem = {\n      type: 'method',\n      name: abi.name,\n      components: abi.inputs\n    };\n    super(methodDataItem, dataTypeFactory);\n    this._methodSignature = this._computeSignature();\n    this._methodSelector = this._computeSelector();\n    const returnDataItem = {\n      type: 'tuple',\n      name: abi.name,\n      components: abi.outputs\n    };\n    this._returnDataType = new tuple_1.TupleDataType(returnDataItem, this.getFactory());\n  }\n\n  encode(value, rules) {\n    const calldata = super.encode(value, rules, this._methodSelector);\n    return calldata;\n  }\n\n  decode(calldata, rules) {\n    const value = super.decode(calldata, rules, this._methodSelector);\n    return value;\n  }\n\n  strictDecode(calldata, rules) {\n    const value = super.decode(calldata, Object.assign({}, rules, {\n      isStrictMode: true\n    }), this._methodSelector);\n    const valueAsArray = _.isObject(value) ? _.values(value) : [value];\n\n    switch (valueAsArray.length) {\n      case 0:\n        return undefined;\n\n      case 1:\n        return valueAsArray[0];\n\n      default:\n        return valueAsArray;\n    }\n  }\n\n  encodeReturnValues(value, rules) {\n    const returnData = this._returnDataType.encode(value, rules);\n\n    return returnData;\n  }\n\n  decodeReturnValues(returndata, rules) {\n    const returnValues = this._returnDataType.decode(returndata, rules);\n\n    return returnValues;\n  }\n\n  strictDecodeReturnValue(returndata, rules) {\n    const returnValues = this._returnDataType.decode(returndata, Object.assign({}, rules, {\n      isStrictMode: true\n    }));\n\n    const returnValuesAsArray = _.isObject(returnValues) ? _.values(returnValues) : [returnValues];\n\n    switch (returnValuesAsArray.length) {\n      case 0:\n        return undefined;\n\n      case 1:\n        return returnValuesAsArray[0];\n\n      default:\n        return returnValuesAsArray;\n    }\n  }\n\n  getSignatureType() {\n    return this._methodSignature;\n  }\n\n  getSelector() {\n    return this._methodSelector;\n  }\n\n  getReturnValueDataItem() {\n    const returnValueDataItem = this._returnDataType.getDataItem();\n\n    return returnValueDataItem;\n  }\n\n  _computeSignature() {\n    const memberSignature = this._computeSignatureOfMembers();\n\n    const methodSignature = `${this.getDataItem().name}${memberSignature}`;\n    return methodSignature;\n  }\n\n  _computeSelector() {\n    const signature = this._computeSignature();\n\n    const selector = ethUtil.bufferToHex(ethUtil.toBuffer(ethUtil.sha3(signature).slice(constants_1.constants.HEX_SELECTOR_BYTE_OFFSET_IN_CALLDATA, constants_1.constants.HEX_SELECTOR_LENGTH_IN_BYTES)));\n    return selector;\n  }\n\n}\n\nexports.MethodDataType = MethodDataType;","map":{"version":3,"sources":["../../../../src/abi_encoder/evm_data_types/method.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ethUtil = require(\"ethereumjs-util\");\nconst _ = require(\"lodash\");\nconst set_1 = require(\"../abstract_data_types/types/set\");\nconst constants_1 = require(\"../utils/constants\");\nconst tuple_1 = require(\"./tuple\");\nclass MethodDataType extends set_1.AbstractSetDataType {\n    constructor(abi, dataTypeFactory) {\n        const methodDataItem = { type: 'method', name: abi.name, components: abi.inputs };\n        super(methodDataItem, dataTypeFactory);\n        this._methodSignature = this._computeSignature();\n        this._methodSelector = this._computeSelector();\n        const returnDataItem = { type: 'tuple', name: abi.name, components: abi.outputs };\n        this._returnDataType = new tuple_1.TupleDataType(returnDataItem, this.getFactory());\n    }\n    encode(value, rules) {\n        const calldata = super.encode(value, rules, this._methodSelector);\n        return calldata;\n    }\n    decode(calldata, rules) {\n        const value = super.decode(calldata, rules, this._methodSelector);\n        return value;\n    }\n    strictDecode(calldata, rules) {\n        const value = super.decode(calldata, Object.assign({}, rules, { isStrictMode: true }), this._methodSelector);\n        const valueAsArray = _.isObject(value) ? _.values(value) : [value];\n        switch (valueAsArray.length) {\n            case 0:\n                return undefined;\n            case 1:\n                return valueAsArray[0];\n            default:\n                return valueAsArray;\n        }\n    }\n    encodeReturnValues(value, rules) {\n        const returnData = this._returnDataType.encode(value, rules);\n        return returnData;\n    }\n    decodeReturnValues(returndata, rules) {\n        const returnValues = this._returnDataType.decode(returndata, rules);\n        return returnValues;\n    }\n    strictDecodeReturnValue(returndata, rules) {\n        const returnValues = this._returnDataType.decode(returndata, Object.assign({}, rules, { isStrictMode: true }));\n        const returnValuesAsArray = _.isObject(returnValues) ? _.values(returnValues) : [returnValues];\n        switch (returnValuesAsArray.length) {\n            case 0:\n                return undefined;\n            case 1:\n                return returnValuesAsArray[0];\n            default:\n                return returnValuesAsArray;\n        }\n    }\n    getSignatureType() {\n        return this._methodSignature;\n    }\n    getSelector() {\n        return this._methodSelector;\n    }\n    getReturnValueDataItem() {\n        const returnValueDataItem = this._returnDataType.getDataItem();\n        return returnValueDataItem;\n    }\n    _computeSignature() {\n        const memberSignature = this._computeSignatureOfMembers();\n        const methodSignature = `${this.getDataItem().name}${memberSignature}`;\n        return methodSignature;\n    }\n    _computeSelector() {\n        const signature = this._computeSignature();\n        const selector = ethUtil.bufferToHex(ethUtil.toBuffer(ethUtil\n            .sha3(signature)\n            .slice(constants_1.constants.HEX_SELECTOR_BYTE_OFFSET_IN_CALLDATA, constants_1.constants.HEX_SELECTOR_LENGTH_IN_BYTES)));\n        return selector;\n    }\n}\nexports.MethodDataType = MethodDataType;\n//# sourceMappingURL=method.js.map"]},"metadata":{},"sourceType":"module"}